{"version":3,"sources":["../src/helpers.js"],"names":["applyPropertiesValidators","getObjectValues","MODEL_VALUES_SYMBOL","object","schema","values","joiSchema","properties","key","hasOwnProperty","validator","reach","validate","get","set","val","undefined","enumerable","configurable","fieldName","value","error","Error"],"mappings":";;;;;;;;;;;;;;;;;;;;;;QAMSA,yB,GAAAA,yB;QAsCAC,e,GAAAA,e;;AA5CT;;;;AACA;;;;;;AAEA,IAAMC,sBAAsB,sBAAO,aAAP,CAA5B;;AAGA,SAASF,yBAAT,CAAoCG,MAApC,EAA4CC,MAA5C,EAAiE;AAAA,MAAbC,MAAa,uEAAJ,EAAI;;AAC/D,MAAMC,YAAY,oBAAUF,MAAV,CAAlB;;AAEAD,SAAOD,mBAAP,IAA8B,EAA9B;;AAEA,MAAMK,aAAa,EAAnB;;AAL+D,6BAMtDC,GANsD;AAO7D,QAAI,CAACJ,OAAOG,UAAP,CAAkBE,cAAlB,CAAiCD,GAAjC,CAAL,EAA4C;AAC1C;AAAA;AAAA;AACD;AACD,QAAME,YAAY,cAAIC,KAAJ,CAAUL,SAAV,EAAqBE,GAArB,CAAlB;;AAEAI,aAASJ,GAAT,EAAcH,OAAOG,GAAP,CAAd,EAA2BE,SAA3B;AACAP,WAAOD,mBAAP,EAA4BM,GAA5B,IAAmCH,OAAOG,GAAP,CAAnC;;AAEAD,eAAWC,GAAX,IAAkB;AAChBK,WAAK;AAAA,eAAMV,OAAOD,mBAAP,EAA4BM,GAA5B,CAAN;AAAA,OADW;AAEhBM,WAAK,aAACC,GAAD,EAAS;AACZH,iBAASJ,GAAT,EAAcO,GAAd,EAAmBL,SAAnB;;AAECK,gBAAQC,SAAT,GAAuB,OAAOb,OAAOD,mBAAP,EAA4BM,GAA5B,CAA9B,GAAmEL,OAAOD,mBAAP,EAA4BM,GAA5B,IAAmCO,GAAtG;AACD,OANe;AAOhBE,kBAAY,IAPI;AAQhBC,oBAAc;AARE,KAAlB;AAf6D;;AAM/D,OAAK,IAAIV,GAAT,IAAgBJ,OAAOG,UAAvB,EAAmC;AAAA,qBAA1BC,GAA0B;;AAAA;AAmBlC;;AAED,kCAAwBL,MAAxB,EAAgCI,UAAhC;;AAEA,WAASK,QAAT,CAAmBO,SAAnB,EAA8BC,KAA9B,EAAqChB,MAArC,EAA6C;AAAA,wBACzB,cAAIQ,QAAJ,CAAaQ,KAAb,EAAoBhB,MAApB,CADyB;AAAA,QACnCiB,KADmC,iBACnCA,KADmC;;AAE3C,QAAIA,UAAU,IAAd,EAAoB;AAClB,YAAM,IAAIC,KAAJ,qBAA4BF,KAA5B,oBAAgDD,SAAhD,CAAN;AACD;AACF;AACF;;AAGD,SAASlB,eAAT,CAA0BE,MAA1B,EAAkC;AAChC,MAAME,oCAAeF,OAAOD,mBAAP,KAA+B,EAA9C,CAAN;;AAEA,OAAK,IAAIM,GAAT,IAAgBH,MAAhB,EAAwB;AACtB,QAAI,CAACA,OAAOI,cAAP,CAAsBD,GAAtB,CAAL,EAAiC;AAC/B;AACD;AACD,QAAIH,OAAOG,GAAP,MAAgBQ,SAApB,EAA+B;AAC7B,aAAOX,OAAOG,GAAP,CAAP;AACD;AACF;AACD,SAAOL,OAAOD,mBAAP,CAAP;AACD","file":"helpers.js","sourcesContent":["import Joi from 'joi';\r\nimport Enjoi from 'enjoi';\r\n\r\nconst MODEL_VALUES_SYMBOL = Symbol('modelValues');\r\n\r\nexport\r\nfunction applyPropertiesValidators (object, schema, values = {}) {\r\n  const joiSchema = new Enjoi(schema);\r\n\r\n  object[MODEL_VALUES_SYMBOL] = {};\r\n\r\n  const properties = {};\r\n  for (let key in schema.properties) {\r\n    if (!schema.properties.hasOwnProperty(key)) {\r\n      return;\r\n    }\r\n    const validator = Joi.reach(joiSchema, key);\r\n\r\n    validate(key, values[key], validator);\r\n    object[MODEL_VALUES_SYMBOL][key] = values[key];\r\n\r\n    properties[key] = {\r\n      get: () => object[MODEL_VALUES_SYMBOL][key],\r\n      set: (val) => {\r\n        validate(key, val, validator);\r\n\r\n        (val === undefined) ? (delete object[MODEL_VALUES_SYMBOL][key]) : (object[MODEL_VALUES_SYMBOL][key] = val);\r\n      },\r\n      enumerable: true,\r\n      configurable: false\r\n    };\r\n  }\r\n\r\n  Object.defineProperties(object, properties);\r\n\r\n  function validate (fieldName, value, schema) {\r\n    const { error } = Joi.validate(value, schema);\r\n    if (error !== null) {\r\n      throw new Error(`Invalid value \"${value}\" for field ${fieldName}`);\r\n    }\r\n  }\r\n}\r\n\r\nexport\r\nfunction getObjectValues (object) {\r\n  const values = { ...(object[MODEL_VALUES_SYMBOL] || {}) };\r\n\r\n  for (let key in values) {\r\n    if (!values.hasOwnProperty(key)) {\r\n      return;\r\n    }\r\n    if (values[key] === undefined) {\r\n      delete values[key];\r\n    }\r\n  }\r\n  return object[MODEL_VALUES_SYMBOL];\r\n}\r\n"]}